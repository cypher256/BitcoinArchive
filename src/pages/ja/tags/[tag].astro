---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import EntryCard from '../../../components/EntryCard.astro';
import { useTranslations, getEntries, translateTag } from '../../../i18n/utils';

export async function getStaticPaths() {
  const { getEntries } = await import('../../../i18n/utils');
  const entries = await getEntries('ja');
  const tags = new Set<string>();
  for (const entry of entries) {
    for (const tag of entry.data.tags ?? []) {
      tags.add(tag);
    }
  }
  return Array.from(tags).map((tag) => ({
    params: { tag },
    props: { tag },
  }));
}

const lang = 'ja';
const t = useTranslations(lang);
const { tag } = Astro.props;
const entries = await getEntries(lang);
const filtered = entries.filter((e) => (e.data.tags ?? []).includes(tag));
---

<BaseLayout
  title={`${translateTag(tag, lang)} - ${t('site.title')}`}
  description={`タグ「${translateTag(tag, lang)}」のエントリー一覧`}
  lang={lang}
>
  <div class="container">
    <h1>{translateTag(tag, lang)}</h1>
    <p class="entry-count">{filtered.length} エントリー</p>
    {filtered.map((entry) => (
      <EntryCard
        id={entry.id}
        title={entry.data.title}
        date={entry.data.date}
        author={entry.data.author}
        source={entry.data.source}
        description={entry.data.description}
        isSatoshi={entry.data.isSatoshi}
        lang={lang}
        participants={entry.data.participants}
      />
    ))}
  </div>
</BaseLayout>

<style>
  h1 { margin-bottom: 0.25rem; }
  .entry-count {
    font-family: var(--font-heading);
    font-size: 0.9rem;
    color: var(--color-text-muted);
    margin-top: 0;
  }
</style>
