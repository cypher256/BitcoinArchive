---
title: "返信: Bitcoind"
date: 2010-03-05T00:54:40Z
source: correspondence
sourceUrl: "https://mmalmi.github.io/satoshi/"
author: "Satoshi Nakamoto"
participants:
  - name: "Satoshi Nakamoto"
    slug: "satoshi-nakamoto"
  - name: "Martti Malmi"
    slug: "martti-malmi"
description: "実は、代わりにこちらを試してください。こちらの方がより正確です。"
isSatoshi: true
threadId: "satoshi-martti-malmi"
threadTitle: "Satoshi ↔ Martti Malmi Correspondence"
threadPosition: 186
tags:
  - "correspondence"
  - "early-contributor"
  - "development"
secondarySources:
  - name: "Martti Malmi's Published Email Archive"
    url: "https://mmalmi.github.io/satoshi/"
  - name: "COPA v. Wright Trial Exhibits"
    url: "https://www.opencrypto.org/2024-02-22-witnesses-satoshi-correspondence/"
translationStatus: complete
---

実は、代わりにこちらを試してください。こちらの方がより正確です：

void ParseString(const string& str, char c, vector<string>& v)
{
     string::size_type i1 = 0;
     string::size_type i2;
     loop
     {
         i2 = str.find(c, i1);
         if (i2 == str.npos)
         {
             v.push_back(str.substr(i1));
             return;
         }
         v.push_back(str.substr(i1, i2-i1));
         i1 = i2+1;
     }
}



Satoshi Nakamoto wrote:
> util.cのParseStringに問題があります。「unsigned int」型とstr.nposの型であるsize_typeの間の非互換性が原因だと推測しています。
>
> 2つの「unsigned int」を「size_type」に変更してみてください。
>
> old:
> void ParseString(const string& str, char c, vector<string>& v)
> {
>     unsigned int i1 = 0;
>     unsigned int i2;
>     do
>     {
>         i2 = str.find(c, i1);
>         v.push_back(str.substr(i1, i2-i1));
>         i1 = i2+1;
>     }
>     while (i2 != str.npos);
> }
>
> new:
> void ParseString(const string& str, char c, vector<string>& v)
> {
>     size_type i1 = 0;
>     size_type i2;
>     do
>     {
>         i2 = str.find(c, i1);
>         v.push_back(str.substr(i1, i2-i1));
>         i1 = i2+1;
>     }
>     while (i2 != str.npos);
> }
>
>
> mmalmi@cc.hut.fi wrote:
>> gdbでデバッグ中に取得した別のテストランのdebug.logを送ります。プログラムはデバッグ行「irc 8」の後にメモリを食い始め、数秒以内に「terminate called after throwing an instance of 'std::bad_alloc'」でクラッシュしました。
>>
>>> RecvUntilの中にあるようですが、まだ何が問題なのか分かりません。考えられるのは、ソケットが大量の文字を受信している場合くらいです。
>>>
>>> このirc.cppを試してみてください。debug.logが急速に大きくなる可能性があるので、すぐに終了できるよう準備しておいてください。
>>>
>>> mmalmi@cc.hut.fi wrote:
>>>> debug.logを添付します
>>>>
>>>>> かなり絞り込めました。debug.logにIRCの活動が何も表示されていないので、RecvUntilを通過できなかったのだと思います。目視では明らかな問題は見当たりません。ConnectSocketかRecvUntilのどちらかだと思います。
>>>>>
>>>>> 添付のirc.cppとnet.cppで試して、debug.logを送ってください。
>>>>>
>>>>> あるいは、gdbで実行してThreadIRCSeedをステップ実行することもできます
>>>>> gdb --args bitcoin [switches]
>>>>> b ThreadIRCSeed
>>>>> run
>>>>> step
>>>>> またはuでルーチンのステップオーバーとステップアウト。
>>>>>
>>>>> mmalmi@cc.hut.fi wrote:
>>>>>> getinfoに関係なくエラーが発生します。ThreadIRCSeedをコメントアウトしたところ、問題が解決しました。
>>>>>>
>>>>>>> getinfoをしなくても同じ現象が起きますか？
>>>>>>>
>>>>>>> 以下のCreateThreadsをコメントアウトして、1つずつ有効にしていけば、どのスレッドに問題があるか分かります。
>>>>>>>
>>>>>>> net.cpp, under // Start threads
>>>>>>>   CreateThread(ThreadIRCSeed, NULL)
>>>>>>>   CreateThread(ThreadSocketHandler, NULL, true)
>>>>>>>   CreateThread(ThreadOpenConnections, NULL)
>>>>>>>   CreateThread(ThreadMessageHandler, NULL)
>>>>>>>
>>>>>>> init.cpp:
>>>>>>>   CreateThread(ThreadRPCServer, NULL);
>>>>>>>
>>>>>>> mmalmi@cc.hut.fi wrote:
>>>>>>>> 送ります。クラッシュ時のエラーメッセージを伝え忘れていました：
>>>>>>>>
>>>>>>>> terminate called after throwing an instance of 'std::bad_alloc'
>>>>>>>> what():  std::bad_alloc
>>>>>>>>
>>>>>>>>> debug.logを送ってもらえますか？
>>>>>>>>>
>>>>>>>>> mmalmi@cc.hut.fi wrote:
>>>>>>>>>> dddデバッガでbitcoindのビルドをデバッグしようとしましたが、まだうまくいっていません。いつもシステムのメモリを全部使い切って最終的にクラッシュしてしまいます。最新の64ビット版bitcoindのビルドをもう一度送っていただけますか？自分のビルドの問題なのか確認したいです。
>>>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>
>>>>
>>>>
>>
>>
>>
>
>

*出典：COPA対Wright裁判の証言の一環として、2024年2月にMartti MalmiによりGitHubで公開。完全な書簡アーカイブはmmalmi.github.io/satoshi/で閲覧可能。*
